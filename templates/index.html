<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß© –†–µ—à–∞–ª–∫–∞ –°—É–¥–æ–∫—É by –ö–ª–∞—É–¥–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üß© –†–µ—à–∞–ª–∫–∞ –°—É–¥–æ–∫—É</h1>
        <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–µ—à–∏—Ç—å!"</p>
        
        <div class="sudoku-wrapper">
            <table id="sudoku-grid"></table>
        </div>
        
        <div class="buttons">
            <button onclick="solveSudoku()" class="btn btn-solve">‚ú® –†–µ—à–∏—Ç—å!</button>
            <button onclick="clearBoard()" class="btn btn-clear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button onclick="loadExample()" class="btn btn-example">üìù –ü—Ä–∏–º–µ—Ä</button>
        </div>
        
        <div id="message" class="message"></div>
        
        <div class="footer">
            <p>–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –±–ª–∞–≥–æ–¥–∞—Ä—è –ö–ª–∞—É–¥–∏</p>
        </div>
    </div>

    <script>
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∫–∏ 9x9
        function createGrid() {
            const table = document.getElementById('sudoku-grid');
            table.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const row = table.insertRow();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
                if (i === 3 || i === 6) {
                    row.classList.add('border-bottom');
                }
                
                for (let j = 0; j < 9; j++) {
                    const cell = row.insertCell();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
                    if (j === 3 || j === 6) {
                        cell.classList.add('border-right');
                    }
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.maxLength = 1;
                    input.id = `cell-${i}-${j}`;
                    input.className = 'sudoku-cell';
                    
                    // –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã 1-9
                    input.addEventListener('input', function(e) {
                        this.value = this.value.replace(/[^1-9]/g, '');
                    });
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∫–ª–µ—Ç–∫—É
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'ArrowRight' || e.key === 'ArrowLeft' || 
                            e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                            navigate(i, j, e.key);
                            e.preventDefault();
                        }
                    });
                    
                    cell.appendChild(input);
                }
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏
        function navigate(row, col, key) {
            let newRow = row, newCol = col;
            
            switch(key) {
                case 'ArrowRight': newCol = Math.min(8, col + 1); break;
                case 'ArrowLeft': newCol = Math.max(0, col - 1); break;
                case 'ArrowDown': newRow = Math.min(8, row + 1); break;
                case 'ArrowUp': newRow = Math.max(0, row - 1); break;
            }
            
            document.getElementById(`cell-${newRow}-${newCol}`).focus();
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å–∫–∏ –∏–∑ —Å–µ—Ç–∫–∏
        function getBoard() {
            const board = [];
            for (let i = 0; i < 9; i++) {
                const row = [];
                for (let j = 0; j < 9; j++) {
                    const val = document.getElementById(`cell-${i}-${j}`).value;
                    row.push(val ? parseInt(val) : 0);
                }
                board.push(row);
            }
            return board;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ—Å–∫–∏ –≤ —Å–µ—Ç–∫—É
        function setBoard(board, highlightNew = false) {
            const originalBoard = highlightNew ? getBoard() : null;
            
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cell = document.getElementById(`cell-${i}-${j}`);
                    const value = board[i][j];
                    
                    if (value !== 0) {
                        cell.value = value;
                        
                        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —á–∏—Å–µ–ª
                        if (highlightNew && originalBoard[i][j] === 0) {
                            cell.classList.add('solved');
                        } else if (highlightNew) {
                            cell.classList.add('original');
                        }
                    } else {
                        cell.value = '';
                    }
                }
            }
        }

        // –†–µ—à–µ–Ω–∏–µ —Å—É–¥–æ–∫—É
        async function solveSudoku() {
            const board = getBoard();
            const messageDiv = document.getElementById('message');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ –≤–≤–µ–¥–µ–Ω–æ
            const hasNumbers = board.some(row => row.some(num => num !== 0));
            if (!hasNumbers) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∏—Å–µ–ª!', 'error');
                return;
            }
            
            messageDiv.textContent = '‚è≥ –†–µ—à–∞—é...';
            messageDiv.className = 'message info';
            
            try {
                const response = await fetch('/solve', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({board: board})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    setBoard(data.solution, true);
                    showMessage('‚úÖ –°—É–¥–æ–∫—É —Ä–µ—à–µ–Ω–æ!', 'success');
                } else {
                    showMessage('‚ùå ' + data.message, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞!', 'error');
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –¥–æ—Å–∫–∏
        function clearBoard() {
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cell = document.getElementById(`cell-${i}-${j}`);
                    cell.value = '';
                    cell.classList.remove('solved', 'original');
                }
            }
            document.getElementById('message').textContent = '';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–º–µ—Ä–∞
        function loadExample() {
            const example = [
                [5, 3, 0, 0, 7, 0, 0, 0, 0],
                [6, 0, 0, 1, 9, 5, 0, 0, 0],
                [0, 9, 8, 0, 0, 0, 0, 6, 0],
                [8, 0, 0, 0, 6, 0, 0, 0, 3],
                [4, 0, 0, 8, 0, 3, 0, 0, 1],
                [7, 0, 0, 0, 2, 0, 0, 0, 6],
                [0, 6, 0, 0, 0, 0, 2, 8, 0],
                [0, 0, 0, 4, 1, 9, 0, 0, 5],
                [0, 0, 0, 0, 8, 0, 0, 7, 9]
            ];
            setBoard(example);
            showMessage('üìù –ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∏–º–µ—Ä —Å—É–¥–æ–∫—É', 'info');
        }

        // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        createGrid();
    </script>
</body>
</html>